#!/bin/bash

# Check if at least a lab directory is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <lab_directory> [--run]"
  echo "  <lab_directory>: Directory containing the lab code (e.g., lab3)"
  echo "  --run: Optional flag to run the binary after compilation"
  exit 1
fi

LAB_DIR="$1"
SRC_DIR="$LAB_DIR"
DIST_DIR="$LAB_DIR/dist"
OUTPUT="$DIST_DIR/main"
RUN_BINARY=false

# Check for --run flag
if [ "$2" = "--run" ]; then
  RUN_BINARY=true
fi

# Check if the lab directory exists
if [ ! -d "$LAB_DIR" ]; then
  echo "Error: Directory '$LAB_DIR' does not exist."
  exit 1
fi

# Create the dist directory if it doesn't exist
mkdir -p "$DIST_DIR"

# Compile all .c files in the lab directory
echo "Compiling sources in '$LAB_DIR'..."
gcc "$SRC_DIR"/*.c -o "$OUTPUT" -I./include -framework OpenGL -framework GLUT -L./bin

# Check if compilation was successful
if [ $? -ne 0 ]; then
  echo "Compilation failed."
  exit 1
else
  echo "Compilation successful. Binary created at '$OUTPUT'."
fi

# Run the compiled binary if the --run flag is provided
if [ "$RUN_BINARY" = true ]; then
  echo "Running '$OUTPUT'..."
  "$OUTPUT"
fi
